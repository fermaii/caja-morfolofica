<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caja Morfológica del Tipograma - Karl Gerstner</title>
    <style>
        /* Estética Suiza: Helvetica y Grillas */
        body { 
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; 
            padding: 40px; 
            background-color: #ffffff; 
            color: #000000;
            line-height: 1.4;
        }

        .container { 
            max-width: 1100px; 
            margin: 0 auto; 
        }

        h1 { font-weight: 700; text-transform: uppercase; letter-spacing: -1px; margin-bottom: 5px; font-size: 1.5rem; }
        .subtitle { color: #666; margin-bottom: 30px; border-bottom: 1px solid #000; padding-bottom: 10px; font-size: 0.9rem; }

        /* Controles */
        .controls { margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
        button { 
            font-family: inherit; font-weight: bold; padding: 10px 20px; 
            border: 1px solid #000; cursor: pointer; background: #fff; font-size: 0.7rem; text-transform: uppercase;
        }
        .active-mode { background: #000 !important; color: #fff !important; }
        button:hover { background: #f0f0f0; }
        .btn-export { background: #f9f9f9; }

        /* Tabla */
        .table-wrapper { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 13px; }
        th, td { border: 1px solid #ccc; padding: 12px; vertical-align: top; text-align: left; }
        th { background: #f9f9f9; font-weight: 700; width: 220px; }

        /* Estados */
        .selectable { cursor: pointer; }
        .selected { background-color: #000 !important; color: #fff !important; }
        .edit-input { width: 100%; border: none; background: transparent; font-family: inherit; font-size: inherit; outline: none; }
        
        .delete-btn { 
            color: #ff0000; cursor: pointer; margin-right: 8px; font-weight: bold; 
            display: none; /* Solo visible en modo edición */
        }
        .editing .delete-btn { display: inline; }

        /* Resultado */
        .result { 
            margin-top: 40px; padding: 20px; border: 1px solid #000;
            background: #f9f9f9; 
        }
        .result strong { display: block; margin-bottom: 10px; text-transform: uppercase; font-size: 0.8rem; }
        .code-chain { font-size: 1.1rem; font-weight: bold; letter-spacing: 0.5px; }
        
        .footer-cite { margin-top: 40px; font-size: 0.75rem; color: #777; border-top: 1px solid #eee; padding-top: 15px; }

        @media (max-width: 600px) {
            body { padding: 20px; }
            th { width: 120px; }
        }
    </style>
</head>
<body class="editing">

<div class="container">
    <h1>Caja Morfológica del Tipograma</h1>
    <div class="subtitle">Programa como lógica — Karl Gerstner, <i>Diseñar Programas</i></div>

    <div class="controls">
        <button id="btnEdit" class="active-mode" onclick="setMode('edit')">Modo Edición</button>
        <button id="btnUse" onclick="setMode('use')">Modo Uso</button>
        <button onclick="addRow()">+ Parámetro</button>
        <button class="btn-export" onclick="downloadResult()">Exportar Solución</button>
    </div>

    <div class="table-wrapper">
        <table id="morphTable">
            <thead>
                <tr>
                    <th>PARÁMETROS (Criterios)</th>
                    <th colspan="4">COMPONENTES</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <div class="result">
        <strong>Solución obtenida por el programa:</strong>
        <span class="code-chain" id="solutionPath">— — —</span>
    </div>

    <div class="footer-cite">
        <strong>Referencia bibliográfica:</strong> Gerstner, K. <i>Diseñar Programas</i>. Basado en el método morfológico de Fritz Zwicky (1953).
    </div>
</div>

<script>
    let currentMode = 'edit';
    let matrixData = [
        { param: "a. Contraste", opts: ["Alto", "Medio", "Bajo", "Monolineal"] },
        { param: "b. Eje de modulación", opts: ["Tradicional", "Invertido", "Oblicuo", "Variable"] },
        { param: "c. Peso", opts: ["Negrita", "Regular", "Light", "Otro"] },
        { param: "d. Morfología", opts: ["Geométrica", "Caligráfica", "Script", "Otro"] },
        { param: "e. Expresión (Forma)", opts: ["Curva", "Recta", "Mezcla", "Otro"] },
        { param: "f. Contrucción", opts: ["Grilla", "Pluma", "Dibujo", "Modular"] },
        { param: "g. Uniones", opts: ["Redondeadas", "Rectas", "Trampa de tinta", "Otro"] },
        { param: "h. Altura de X", opts: ["Baja", "Normal", "Alta", "Variable"] },
        { param: "i. Uso", opts: ["Display", "Texto", "Experimental", "Otro"] },
        { param: "j. Ancho", opts: ["Condensada", "Normal", "Extendida", "Variable"] },
        { param: "k. Proporciones", opts: ["Tradicional", "Geometrica", "Monoespaciada", "Otro"] },
        { param: "l. Concepto", opts: ["Solución técnica", "Expresividad", "Experimentalidad", "Otro"] },
        { param: "m. Terminaciones", opts: ["Serif", "Sans serif", "Otro", "..."] },
        { param: "n. Tipo de serifa", opts: ["Tradicional", "Egipcia", "Gótica", "Didot"] },
        { param: "ñ. Contraforma", opts: ["Normal", "Modificada", "Nula", "Cortante"] },
        { param: "o. Estructura", opts: ["Stencil", "Normal", "Inline", ""] },
        { param: "p. Tecnología", opts: ["Variable", "Color", "Imagen", "Normal"] },
        { param: "q. Bordes", opts: ["Redondeados", "Rectos", "Puntiagudos", "Otro"] },
        { param: "r. Métricas", opts: ["Tradicionales", "Misma altura", "Experimentales", "Variables"] },
        { param: "s. Relleno", opts: ["Lineas", "Sólido", "Degradé", "Detalle/textura"] },
        { param: "t. Acabado", opts: ["Vectorial", "Texturado", "Experimental", "Otro"] },
        { param: "u. Caja", opts: ["Normal", "Rellena", "Invertido", "Extendido"] },
        { param: "v. Inclinación", opts: ["Derecha", "Itálica", "Itálica invertida", "Otra"] }
    ];

    let selections = {}; 

    function setMode(mode) {
        currentMode = mode;
        document.body.className = mode === 'edit' ? 'editing' : 'using';
        document.getElementById('btnEdit').className = (mode === 'edit' ? 'active-mode' : '');
        document.getElementById('btnUse').className = (mode === 'use' ? 'active-mode' : '');
        renderTable();
    }

    function addRow() {
        matrixData.push({ param: "Nuevo Criterio", opts: ["", "", "", ""] });
        renderTable();
    }

    function removeRow(idx) {
        matrixData.splice(idx, 1);
        delete selections[idx];
        renderTable();
        updateResult();
    }

    function updateData(rIdx, oIdx, val) {
        if(oIdx === -1) matrixData[rIdx].param = val;
        else matrixData[rIdx].opts[oIdx] = val;
    }

    function toggleOption(rIdx, opt) {
        if(currentMode !== 'use' || !opt) return;
        if (!selections[rIdx]) selections[rIdx] = [];
        
        const pos = selections[rIdx].indexOf(opt);
        if (pos > -1) selections[rIdx].splice(pos, 1);
        else selections[rIdx].push(opt);
        
        renderTable();
        updateResult();
    }

    function updateResult() {
        let chain = [];
        for (let r in selections) {
            if (selections[r].length > 0) {
                let id = matrixData[r].param.split('.')[0];
                chain.push(id + ": " + selections[r].join(', '));
            }
        }
        document.getElementById('solutionPath').innerText = chain.join(' / ') || "— — —";
    }

    function renderTable() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        matrixData.forEach((row, rIdx) => {
            const tr = document.createElement('tr');
            const th = document.createElement('th');
            
            if(currentMode === 'edit') {
                th.innerHTML = `<span class="delete-btn" onclick="removeRow(${rIdx})">✕</span><input class="edit-input" value="${row.param}" onchange="updateData(${rIdx}, -1, this.value)">`;
            } else {
                th.innerText = row.param;
            }
            tr.appendChild(th);

            row.opts.forEach((opt, oIdx) => {
                const td = document.createElement('td');
                if(currentMode === 'edit') {
                    td.innerHTML = `<input class="edit-input" placeholder="..." value="${opt}" onchange="updateData(${rIdx}, ${oIdx}, this.value)">`;
                } else {
                    td.innerText = opt;
                    if(opt) {
                        const sel = selections[rIdx] && selections[rIdx].includes(opt);
                        td.className = 'selectable' + (sel ? ' selected' : '');
                        td.onclick = () => toggleOption(rIdx, opt);
                    }
                }
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });
    }

    function downloadResult() {
        const txt = document.getElementById('solutionPath').innerText;
        const blob = new Blob([`PROGRAMA GERSTNER\n\nSolución: ${txt}`], {type: 'text/plain'});
        const a = document.createElement('a');
        a.download = 'solucion-gerstner.txt';
        a.href = URL.createObjectURL(blob);
        a.click();
    }

    renderTable();
</script>
</body>
</html>
